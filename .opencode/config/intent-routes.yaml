# Intent Routing Configuration
# Defines how Tachikoma orchestrator routes tasks based on classified intent
# Version: 1.1.4
#
# ⚠️  CRITICAL: Skill vs Subagent Distinction
# -----------------------------------------
# SKILL:    Guidance document that you LOAD and FOLLOW
#           Usage: skill({ name: "code-agent" })
#           Output: Returns <skill_content> block with instructions
#           Then: Execute using tools directly (Edit, Read, Grep, etc.)
#           Examples: code-agent, analysis-agent, research-agent
#
# SUBAGENT: Delegated worker that you INVOKE
#           Usage: task(subagent_type="{name}", ...)
#           Then: Wait for subagent to complete and return result
#           Examples: rlm-subcall, rlm-optimized
#
# NEVER use task() for skills or skill() for subagents!
# -----------------------------------------

# SKILL CHAINS: Load multiple skills sequentially
# Usage: Call skill() for each skill in the chain
# Example:
#   1. skill({ name: "code-agent" }) → execute
#   2. skill({ name: "verifier-code-agent" }) → execute
#   3. skill({ name: "formatter" }) → execute
# -----------------------------------------

# ============================================
# FEATURE FLAGS
# ============================================
# Toggle features on/off for easy migration.
# Set to false to disable RLM (will fall back to general subagent).
# ============================================
features:
  rlm_enabled: true # Set to false when opencode adds native RLM
  rlm_skill_path: ".opencode/skills/rlm" # For removal reference

# ============================================
# INTENT ROUTES
# ============================================
routes:
  # Debug: Finding and fixing issues
  debug:
    description: Finding and fixing issues, troubleshooting
    confidence_threshold: 0.7
    context_modules:
      - 00-core-contract
      - 11-functional-thinking
      - 10-coding-standards
      - 12-commenting-rules # COUPLED: Must load with coding-standards
    skill: code-agent
    skill_load_instruction: 'skill({ name: "code-agent" })'
    skill_usage: "Load skill, then follow its workflow (inspect→extract→validate→implement→verify→stop) using tools directly"
    invoke_via: skill # skill = load and follow | subagent = delegate
    tools:
      - Read
      - Grep
      - Bash
    strategy: direct
    notes: Use for bugs, errors, and broken functionality

  # Implement: Writing or modifying code
  implement:
    description: Writing or modifying code, adding features
    confidence_threshold: 0.7
    context_modules:
      - 00-core-contract
      - 11-functional-thinking
      - 10-coding-standards
      - 12-commenting-rules # COUPLED: Must load with coding-standards
    skill: code-agent
    skill_load_instruction: 'skill({ name: "code-agent" })'
    skill_usage: "Load skill, then follow its workflow (inspect→extract→validate→implement→verify→stop) using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Write
      - Edit
      - Bash
    strategy: direct
    notes: Use for new features, components, and implementations

  # Review-General: General code analysis and auditing
  review-general:
    description: General code analysis and quality assessment
    confidence_threshold: 0.7
    context_modules:
      - 00-core-contract
      - 11-functional-thinking
      - 10-coding-standards
      - 12-commenting-rules # COUPLED: Must load with coding-standards
      - 30-research-methods
    skill: analysis-agent
    skill_load_instruction: 'skill({ name: "analysis-agent" })'
    skill_usage: "Load skill, then follow its analysis workflow using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Grep
    strategy: direct
    notes: Use for general code analysis, architectural review, explanation

  # Code-Review: Structured PR review with priority classification
  code-review:
    description: Structured pull request review with priority classification (CRITICAL/IMPORTANT/SUGGESTION)
    confidence_threshold: 0.7
    context_modules:
      - 00-core-contract
      - 10-coding-standards
      - 12-commenting-rules # COUPLED: Must load with coding-standards
    skill: code-review
    skill_load_instruction: 'skill({ name: "code-review" })'
    skill_usage: "Load skill, then follow its structured review workflow with priority classification using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Grep
    strategy: direct
    notes: Use for PR reviews, issue triage, formal code review with structured output

  # Refactor: Restructuring existing code
  refactor:
    description: Restructuring and improving existing code
    confidence_threshold: 0.7
    context_modules:
      - 00-core-contract
      - 11-functional-thinking
      - 10-coding-standards
      - 12-commenting-rules # COUPLED: Must load with coding-standards
    skill: code-agent
    skill_load_instruction: 'skill({ name: "code-agent" })'
    skill_usage: "Load skill, then follow its refactoring workflow using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Write
      - Edit
      - Bash
    strategy: direct
    notes: Use for refactoring, restructuring, and code improvement

  # Research: Investigation and information gathering
  research:
    description: Finding information, investigating
    confidence_threshold: 0.6
    context_modules:
      - 00-core-contract
      - 30-research-methods
    skill: research-agent
    skill_load_instruction: 'skill({ name: "research-agent" })'
    skill_usage: "Load skill, then follow its research methodology using tools directly"
    invoke_via: skill
    tools:
      - Read
      - WebFetch
      - Grep
    strategy: direct
    notes: Use for learning APIs, understanding code, exploring solutions

  # DevOps: CI/CD, pipelines, deployments, automation
  devops:
    description: CI/CD pipelines, deployments, automation, infrastructure
    confidence_threshold: 0.6
    low_confidence_threshold: 0.4 # Trigger self-learning if below this
    context_modules:
      - 00-core-contract
      - 20-git-workflow # CI/CD is related to git workflows
    skill: research-agent # Still research-oriented (config/docs)
    skill_load_instruction: 'skill({ name: "research-agent" })'
    skill_usage: "Load skill, then follow research methodology for DevOps config"
    invoke_via: skill
    tools:
      - Read
      - WebFetch
      - Grep
    strategy: direct
    notes: Use for GitHub Actions, GitLab CI, Jenkins, deployments, infrastructure config

  # Git: Version control operations
  git:
    description: Version control operations, commits, branches
    confidence_threshold: 0.8
    context_modules:
      - 00-core-contract
      - 20-git-workflow
    skill: git-commit
    skill_load_instruction: 'skill({ name: "git-commit" })'
    skill_usage: "Load skill, then follow its git workflow using tools directly"
    invoke_via: skill
    tools:
      - Bash
    strategy: direct
    notes: Use for commits, branches, and git operations

  # PR: Pull request descriptions
  pr:
    description: Write pull request descriptions documenting changes for future maintainers
    confidence_threshold: 0.7
    context_modules:
      - 00-core-contract
      - 12-commenting-rules
    skill: pr
    skill_load_instruction: 'skill({ name: "pr" })'
    skill_usage: "Load skill, then follow its PR description writing workflow using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Bash
    strategy: direct
    notes: Use for writing PR descriptions, documenting changes, PR summaries

  # Document: Documentation tasks
  document:
    description: Creating or updating documentation
    confidence_threshold: 0.6
    context_modules:
      - 00-core-contract
      - 12-commenting-rules # Documentation includes code comments
    skill: self-learning
    skill_load_instruction: 'skill({ name: "self-learning" })'
    skill_usage: "Load skill, then follow its documentation workflow using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Write
    strategy: direct
    notes: Use for README updates, docs, and comments

  # Complex-Large-Context: Processing large codebases requiring chunking
  # NOTE: Uses RLM subagent - see .opencode/skills/rlm/REMOVAL.md for removal
  complex-large-context:
    description: Process large codebases or documents requiring chunking (>2000 tokens)
    confidence_threshold: 0.3  # LOW threshold to trigger for large tasks
    context_modules:
      - 00-core-contract
    subagent: rlm-optimized
    fallback_subagent: general # Fallback when RLM disabled or unavailable
    fallback_subagent_when: "features.rlm_enabled == false"
    subagent_invoke_instruction: "task(subagent_type='rlm-optimized', description='...', prompt='...')"
    subagent_usage: "Delegate task to subagent and wait for completion"
    invoke_via: subagent # subagent = delegate via task() | skill = load and follow
    tools:
      - Read
    strategy: rlm
    notes: Use for large file processing, entire codebase analysis, dataset processing (uses MIT-style adaptive chunking). Set features.rlm_enabled=false to use general subagent instead.

  # Complex-Workflow: Multi-phase development with quality gates
  complex-workflow:
    description: Multi-phase development with quality gates, systematic validation
    confidence_threshold: 0.6
    context_modules:
      - 00-core-contract
      - 10-coding-standards
      - 12-commenting-rules # COUPLED: Must load with coding-standards
    skill: workflow-management
    skill_load_instruction: 'skill({ name: "workflow-management" })'
    skill_usage: "Load skill, then follow 7-phase development workflow (ANALYZE → DESIGN → IMPLEMENT → VALIDATE → CLEANUP → DEPLOY → REFLECT) using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Write
      - Edit
      - Bash
    strategy: direct
    notes: Use for production-grade features, quality-critical implementations, systematic development with phase-by-phase validation

  # Unclear: When intent cannot be determined
  unclear:
    description: Ambiguous or unclear user intent
    confidence_threshold: 0.0
    context_modules:
      - 00-core-contract
    action: ask
    notes: Ask user for clarification

  # Skill-Compose: Dynamic skill composition for complex tasks
  skill-compose:
    description: Combining multiple skills for compound tasks
    confidence_threshold: 0.6
    context_modules:
      - 00-core-contract
      - 10-coding-standards
      - 12-commenting-rules # COUPLED: Must load with coding-standards
    skill: skill-composer
    skill_load_instruction: 'skill({ name: "skill-composer" })'
    skill_usage: "Load skill, then follow its composition workflow using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Grep
      - Bash
    strategy: direct
    notes: Use when task requires multiple specialized skills working together

  # Optimize: Cost-aware routing and context optimization
  optimize:
    description: Token optimization, context pruning, efficiency improvements
    confidence_threshold: 0.7
    context_modules:
      - 00-core-contract
    skill: context-manager
    skill_load_instruction: 'skill({ name: "context-manager" })'
    skill_usage: "Load skill, then follow its optimization workflow using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Bash
    strategy: direct
    notes: Use for context cleanup, token reduction, efficiency tuning

  # Explore: Fast codebase exploration (uses OpenCode built-in subagent)
  explore:
    description: Fast codebase exploration, finding files, searching code
    confidence_threshold: 0.5
    context_modules:
      - 00-core-contract
    subagent: explore
    subagent_invoke_instruction: "task(subagent_type='explore', description='...', prompt='...')"
    subagent_usage: "Delegate to explore subagent for fast read-only codebase exploration"
    invoke_via: subagent
    tools:
      - Read
      - Grep
      - Glob
      - Bash
    strategy: direct
    notes: "Use for: finding files by patterns, searching code keywords, answering codebase questions. Optimized for speed."

  # Deep-Research: Complex multi-step research (uses OpenCode built-in subagent)
  deep-research:
    description: Complex multi-step research requiring parallel investigation
    confidence_threshold: 0.5
    context_modules:
      - 00-core-contract
      - 30-research-methods
    subagent: general
    subagent_invoke_instruction: "task(subagent_type='general', description='...', prompt='...')"
    subagent_usage: "Delegate to general subagent for complex multi-step research"
    invoke_via: subagent
    tools:
      - Read
      - Grep
      - Glob
      - Bash
      - WebFetch
    strategy: direct
    notes: "Use for: complex investigations, multi-source research, parallel analysis. Has full tool access except todo."

  # Creative: Creative exploration with strategic variance
  creative:
    description: Creative exploration, unconventional approaches, "surprise me" tasks
    confidence_threshold: 0.5
    context_modules:
      - 00-core-contract
    skill: analysis-agent
    skill_load_instruction: 'skill({ name: "analysis-agent" })'
    skill_usage: "Load skill, explore with creative variance enabled"
    invoke_via: skill
    tools:
      - Read
      - Grep
      - Bash
    strategy: direct
    variance: high
    temperature_override: 0.7
    notes: "Use when user wants creative/exploratory output. Enables strategic variance for interesting results."

  # Verify: Generator-Verifier-Reviser pattern for high-reliability tasks
  verify:
    description: High-reliability code generation with verification loop
    confidence_threshold: 0.6
    context_modules:
      - 00-core-contract
      - 11-functional-thinking
      - 10-coding-standards
      - 12-commenting-rules # COUPLED: Must load with coding-standards
    skill: verifier-code-agent
    skill_load_instruction: 'skill({ name: "verifier-code-agent" })'
    skill_usage: "Load skill, then follow its verify workflow using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Write
      - Edit
      - Bash
    strategy: direct
    notes: "Use for: complex implementations, security-critical code, high-stakes fixes."

  # Security-Audit: OWASP-based security audit workflow
  security-audit:
    description: OWASP-based security audit, vulnerability assessment, threat modeling
    confidence_threshold: 0.7
    context_modules:
      - 00-core-contract
      - 10-coding-standards
      - 12-commenting-rules # COUPLED: Must load with coding-standards
    skill: security-audit
    skill_load_instruction: 'skill({ name: "security-audit" })'
    skill_usage: "Load skill, then follow OWASP Top 10 audit workflow using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Grep
      - Bash
    strategy: direct
    notes: "Use for: security audits, vulnerability assessments, threat modeling, OWASP Top 10 checks, authentication/authorization review"
    variance: low # Security audits must be deterministic

  # Reflect: Explicit self-verification and reflection
  reflect:
    description: Self-critique and adversarial verification for outputs
    confidence_threshold: 0.6
    context_modules:
      - 00-core-contract
      - 10-coding-standards
      - 12-commenting-rules # COUPLED: Must load with coding-standards
    skill: reflection-orchestrator
    skill_load_instruction: 'skill({ name: "reflection-orchestrator" })'
    skill_usage: "Load skill, then follow its reflection workflow using tools directly"
    invoke_via: skill
    tools:
      - Read
      - Write
      - Edit
    strategy: direct
    notes: Use for complex reasoning, high-stakes decisions, and confidence verification.

  # Edit-Optimize: Model-aware edit format selection
  edit-optimize:
    description: Model-specific edit format for maximum success
    confidence_threshold: 0.7
    context_modules:
      - 00-core-contract
    skill: model-aware-editor
    skill_load_instruction: 'skill({ name: "model-aware-editor" })'
    skill_usage: "Load skill, then use hashline processor for reliable edits"
    invoke_via: skill
    tools:
      - Read
      - Write
      - Edit
    strategy: direct
    notes: Use when experiencing edit failures or working with multiple models.

# ============================================
# WORKFLOWS (Sequential - pass context through each stage)
# ============================================
# ⚠️  WORKFLOW USAGE:
# Skills execute SEQUENTIALLY - each skill sees the result of the previous.
# Use when: implement → verify → format, or research → implement
#
# Execution:
#   1. skill({ name: "code-agent" }) → executes → result
#   2. skill({ name: "verifier-code-agent" }) → sees result → executes
#   3. skill({ name: "formatter" }) → formats
#
# mode: sequential (default) - one after another
# ============================================
workflows:
  # High-reliability implementation workflow
  implement-verify:
    description: "Implementation with verification loop"
    skills: [code-agent, verifier-code-agent, formatter]
    mode: sequential
    context_modules:
      - 00-core-contract
      - 10-coding-standards
      - 12-commenting-rules

  # Research-then-implement workflow
  research-implement:
    description: "Research followed by implementation"
    skills: [research-agent, context7, code-agent, formatter]
    mode: sequential
    context_modules:
      - 00-core-contract
      - 10-coding-standards
      - 12-commenting-rules

  # High-stakes security workflow
  security-implement:
    description: "Security-critical implementation"
    skills: [context7, code-agent, verifier-code-agent, reflection-orchestrator]
    mode: sequential
    context_modules:
      - 00-core-contract
      - 10-coding-standards
      - 12-commenting-rules

  # Review with reflection
  deep-review:
    description: "In-depth code review with self-verification"
    skills: [code-review, reflection-orchestrator]
    mode: sequential
    context_modules:
      - 00-core-contract
      - 10-coding-standards
      - 12-commenting-rules

  # Complex research workflow
  complex-research:
    description: "Multi-source research with verification"
    skills: [research-agent, context7, reflection-orchestrator]
    mode: sequential
    context_modules:
      - 00-core-contract
      - 30-research-methods

  # Git-create-pr: Commit and create PR with description
  git-create-pr:
    description: "Commit changes and create pull request"
    skills: [git-commit, pr, formatter]
    mode: sequential
    context_modules:
      - 00-core-contract
      - 20-git-workflow

# ============================================
# SKILLS BULK (All at once - inject all, agent decides)
# ============================================
# ⚠️  SKILLS BULK USAGE:
# ALL skills are loaded at once into context.
# Agent can use ANY of them as needed.
# Use when: multi-tool tasks, agent decides what to use
#
# Execution:
#   1. skill({ name: "code-agent" })
#   2. skill({ name: "verifier-code-agent" })
#   3. skill({ name: "formatter" })
#   → Agent has ALL available, picks what to use
# ============================================
skills_bulk:
  coding-all:
    description: "All coding skills available"
    skills:
      [code-agent, verifier-code-agent, formatter, reflection-orchestrator]

  research-all:
    description: "All research skills available"
    skills: [research-agent, context7, analysis-agent]

  full-stack:
    description: "Full coding + research capabilities"
    skills:
      [
        code-agent,
        verifier-code-agent,
        research-agent,
        context7,
        formatter,
        reflection-orchestrator,
      ]

# ============================================
# COMPOSITE INTENTS
# ============================================
composite:
  enabled: true
  resolution_strategy: union

  definitions:
    - name: implement-and-test
      components:
        - implement
        - debug
      description: Write code and verify it works

    - name: research-and-implement
      components:
        - research
        - implement
      description: Investigate then implement solution

    - name: refactor-and-test
      components:
        - implement
        - debug
      description: Refactor code with verification

# ============================================
# FALLBACK RULES
# ============================================
fallback:
  # When confidence is below threshold
  low_confidence:
    action: ask
    message: "I'm not sure how to categorize this request. Could you clarify what you're trying to do?"

  # When no route matches
  no_match:
    action: ask
    message: "I don't recognize this type of task. Please describe your goal in different terms."

  # When skill/agent is unavailable
  unavailable:
    action: escalate
    message: "The requested resource is unavailable. Trying alternative approach..."

# ============================================
# ROUTING BEHAVIOR
# ============================================
behavior:
  # Always load core-contract first
  always_load_core: true

  # Maximum number of context modules to load
  max_context_modules: 5

  # When to delegate vs handle directly
  delegation_threshold:
    tokens: 2000
    confidence: 0.7

  # Whether to report routing decisions to user
  report_routing: true

  # Whether to include alternative intents in reports
  report_alternatives: true

  # Auto self-learning triggers
  # When confidence falls below threshold after execution, invoke self-learning
  auto_self_learning:
    enabled: true
    low_confidence_threshold: 0.4 # Trigger when final confidence < 0.4
    intents_with_learning:
      - devops # New intent - learn patterns
      - research # How-to questions often ambiguous
      - explore # Codebase exploration patterns
    intents_without_learning:
      - debug # High-stakes - don't learn from failures
      - implement # High-stakes - don't learn from failures
      - git # Well-defined, low ambiguity
    note: "User approval required before applying any learned changes"

  # Context coupling rules
  module_coupling:
    # When coding-standards loads, commenting-rules MUST also load
    10-coding-standards:
      must_co_load:
        - 12-commenting-rules
      reason: "Commenting rules are inseparable from coding standards"
    # When artifacts-policy loads, it provides consent workflow for all skills
    11-artifacts-policy:
      applies_to:
        - code-agent
        - workflow-management
        - task-tracking
        - verifier-code-agent
        - self-learning
      reason: "Artifact consent applies to all skills that create files"

# ============================================
# CONTEXT MODULE PRIORITY
# ============================================
# Lower number = higher priority (loaded first)
module_priority:
  00-core-contract: 0
  10-coding-standards: 10
  11-artifacts-policy: 11 # Artifact consent - loads after core, before other modules
  12-commenting-rules: 12 # Bumped up from 15 - tightly coupled with coding-standards
  20-git-workflow: 20
  30-research-methods: 30
  50-prompt-safety: 50

# ============================================
# RESOURCE TYPE REFERENCE
# ============================================
# Quick lookup for skill vs subagent confusion
#
# SKILLS (Load with Read, execute yourself):
#   code-agent:              .opencode/skills/code-agent/SKILL.md
#   analysis-agent:          .opencode/skills/analysis-agent/SKILL.md
#   research-agent:          .opencode/skills/research-agent/SKILL.md
#   verifier-code-agent:     .opencode/skills/verifier-code-agent/SKILL.md
#   model-aware-editor:      .opencode/skills/model-aware-editor/SKILL.md
#   reflection-orchestrator: .opencode/skills/reflection-orchestrator/SKILL.md
#   skill-composer:          .opencode/skills/skill-composer/SKILL.md
#   context-manager:         .opencode/skills/context-manager/SKILL.md
#   context7:                .opencode/skills/context7/SKILL.md
#   formatter:               .opencode/skills/formatter/SKILL.md
#   git-commit:              .opencode/skills/git-commit/SKILL.md
#   pr:                     .opencode/skills/pr/SKILL.md
#   self-learning:           .opencode/skills/self-learning/SKILL.md
#   code-review:             .opencode/skills/code-review/SKILL.md
#   workflow-management:      .opencode/skills/workflow-management/SKILL.md
#   security-audit:          .opencode/skills/security-audit/SKILL.md
#
# WORKFLOWS (Sequential - pass context through each stage):
#   Skills execute SEQUENTIALLY - each skill sees result of previous
#   Example: implement-verify workflow
#     1. skill({ name: "code-agent" }) → execute
#     2. skill({ name: "verifier-code-agent" }) → sees result → execute
#     3. skill({ name: "formatter" }) → format
#
# SKILLS BULK (All at once - inject all, agent decides):
#   ALL skills loaded at once, agent picks what to use
#   Example:
#     1. skill({ name: "code-agent" })
#     2. skill({ name: "verifier-code-agent" })
#     3. skill({ name: "formatter" })
#     → Agent has ALL available, uses as needed
#
# SUBAGENTS (Delegate with task()):
#   OpenCode Built-in:
#     explore:        task(subagent_type='explore', ...)     # Fast codebase exploration (read-only)
#     general:        task(subagent_type='general', ...)     # Multi-step parallel tasks
#   Tachikoma Custom:
#     rlm-subcall:    task(subagent_type='rlm-subcall', ...) # Chunk processing (internal worker)
#     rlm-optimized:  task(subagent_type='rlm-optimized', ...) # Large context coordinator
#
# RULES:
#   If route has 'skill:' key → use skill() to load
#   If route has 'subagent:' key → use task() to delegate
#   If route matches a workflow → execute skills sequentially
#   If route matches skills_bulk → load all skills at once
# ============================================

# ============================================
# INTENT DETECTION KEYWORDS
# Used by CLI router for fast pattern matching
# ============================================
intent_keywords:
  debug:
    - "fix"
    - "debug"
    - "broken"
    - "error"
    - "bug"
    - "issue"
    - "not working"

  implement:
    - "add"
    - "implement"
    - "create"
    - "write"
    - "build"
    - "make"
    - "feature"
    - "new"
    - "design"

  review-general:
    - "review code"
    - "analyze code"
    - "code quality"
    - "assess"
    - "check this"
    - "explain code"

  code-review:
    - "pr review"
    - "pull request review"
    - "review code changes"
    - "code review with priorities"
    - "review this pr"
    - "formal review"
    - "priority-based review"
    - "triage issues"

  refactor:
    - "refactor"
    - "restructure"
    - "improve"
    - "clean up"
    - "coherent"
    - "reorganize"
    - "simplify"

  research:
    - "research"
    - "find"
    - "investigate"
    - "look up"
    - "search"
    - "discover"

  devops:
    - "deploy"
    - "deployment"
    - "ci"
    - "cd"
    - "pipeline"
    - "workflow"
    - "github actions"
    - "gitlab ci"
    - "jenkins"
    - "automation"
    - "build"
    - "release"
    - "infrastructure"
    - "devops"
    - ".yml"
    - ".yaml"
    - ".github"
    - "gitlab"

  git:
    - "git"
    - "commit"
    - "push"
    - "pull"
    - "merge"
    - "branch"
    - "history"

  pr:
    - "pr description"
    - "pull request description"
    - "document pr changes"
    - "pr summary"
    - "draft pr"
    - "pr body"
    - "create pr description"
    - "generate pr description"

  document:
    - "document"
    - "docs"
    - "readme"
    - "explain"
    - "learn"
    - "remember"

  complex-large-context:
    - "large codebase"
    - "many files"
    - "entire codebase"
    - "bulk operation"
    - "process dataset"
    - "chunk"
    - "recursive"
    - "full scan"
    - "all files"
    - "entire directory"
    - "analyze all files"
    - "large context"

  complex-workflow:
    - "production-grade"
    - "quality gates"
    - "systematic development"
    - "follow development workflow"
    - "validate each phase"
    - "with quality checks"
    - "phase-by-phase"
    - "quality-critical"
    - "validate implementation"

  verify:
    - "verify"
    - "validate"
    - "ensure"
    - "confirm"
    - "reliable"
    - "gvr"

  reflect:
    - "reflect"
    - "self-critique"
    - "adversarial"
    - "double-check"
    - "challenge"

  security-audit:
    - "security audit"
    - "vulnerability scan"
    - "security review"
    - "find security issues"
    - "owasp"
    - "threat modeling"
    - "penetration test"
    - "security assessment"
    - "check security"
    - "audit security"
    - "vulnerability assessment"

  skill-compose:
    - "combine skills"
    - "multiple skills"
    - "compose"
    - "chain skills"
    - "orchestrate"

  optimize:
    - "optimize"
    - "token"
    - "context cleanup"
    - "efficiency"
    - "prune"

  explore:
    - "find files"
    - "search code"
    - "where is"
    - "show me"
    - "locate"
    - "explore codebase"
    - "look for"
    - "find all"

  creative:
    - "surprise me"
    - "creative"
    - "unconventional"
    - "experiment"
    - "try something different"
    - "interesting"
    - "novel"
    - "brainstorm"

  deep-research:
    - "deep research"
    - "thorough investigation"
    - "comprehensive analysis"
    - "multi-step research"
    - "research in parallel"
    - "investigate thoroughly"

# ============================================
# STRATEGIC VARIANCE
# ============================================
# Strategic variance introduces controlled randomness to produce
# more interesting/creative outputs SOMETIMES (not always).
#
# Variance Levels:
#   - low: Standard deterministic behavior (default)
#   - medium: 20% chance of creative deviation
#   - high: 40% chance of creative deviation, higher temperature
#
# Use Cases:
#   - Brainstorming sessions
#   - Exploratory coding
#   - "Surprise me" requests
#   - Learning/demonstration scenarios
#
# IMPORTANT: Strategic variance should NOT be used for:
#   - Security-critical code
#   - Production deployments
#   - Data migrations
#   - Any task requiring deterministic output
# ============================================
strategic_variance:
  enabled: true

  levels:
    low:
      probability: 0.0
      temperature: 0.0
      description: "Fully deterministic, no variance"

    medium:
      probability: 0.2
      temperature: 0.5
      description: "Occasional creative deviation"

    high:
      probability: 0.4
      temperature: 0.7
      description: "Frequent creative deviation, more interesting outputs"

  # Default variance by intent
  default_variance:
    debug: low # Must be deterministic
    implement: low # Code should be correct
    review: low # Analysis should be accurate
    research: medium # Some exploration OK
    git: low # Version control must be precise
    document: medium # Documentation can be creative
    complex: medium # Complex tasks may benefit from exploration
    explore: low # Codebase exploration should be accurate
    creative: high # Explicitly requested creativity
    deep-research: medium # Research can have some exploration

  # Intents that MUST NEVER have variance (safety)
  variance_forbidden:
    - verify # Verification must be deterministic
    - security-audit # Security must be precise
    - production-deploy # Deployments must be predictable

