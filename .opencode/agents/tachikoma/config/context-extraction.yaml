# Context Extraction Rules
# Defines which sections of context modules to load for each intent
# This reduces token consumption by loading only relevant content

---
version: 1.0.0

extraction_rules:
  # 12-commenting-rules.md (992 lines) - Only load for actual code editing
  "12-commenting-rules.md":
    intents_to_load:
      - implement
      - debug
      - refactor
    sections:
      coding_tasks:
        - "prohibited patterns"
        - "typescript specific rules"
        - "violation response"
        - "required patterns"
      skip:
        - "core philosophy"
        - "presumption of silence"
        - "test questions"
    # For review/research intents, skip entirely (0 tokens)
    intents_to_skip:
      - review
      - research
      - git
      - document

  # 00-core-contract.md (401 lines) - Modular loading
  "00-core-contract.md":
    base_sections:
      - "Externalized Context Mode"
      - "Universal Execution Loop"
      - "Precedence Rules"
    intent_specific:
      debug:
        sections:
          - "Validation Before Action"
          - "Stop Conditions"
      implement:
        sections:
          - "Context Economics"
          - "Minimal Change Principle"
          - "Reuse Before Creation"
      research:
        sections:
          - "Context Economics"
      review:
        sections:
          - "Context Economics"
      git:
        sections: []
        # Git only needs base sections

  # 10-coding-standards.md (519 lines) - Intent-aware loading
  "10-coding-standards.md":
    intents_to_load:
      - implement
      - debug
      - refactor
      - review
    sections:
      coding_tasks:
        - "First Principle"
        - "Naming Conventions"
        - "Code Organization"
      review_tasks:
        - "Testing Standards"
        - "Patterns"
    # Skip for non-coding intents
    intents_to_skip:
      - research
      - git
      - document

  # 20-git-workflow.md (254 lines) - Only load for git intent
  "20-git-workflow.md":
    intents_to_load:
      - git
    # All intents skip except git
    intents_to_skip:
      - implement
      - debug
      - refactor
      - review
      - research
      - document

  # 30-research-methods.md (315 lines) - Only load for research/review
  "30-research-methods.md":
    intents_to_load:
      - research
      - review
    sections:
      research_tasks:
        - "Framing Methodology"
        - "Source Evaluation"
        - "Synthesis Rules"
    intents_to_skip:
      - implement
      - debug
      - refactor
      - git
      - document

  # 11-functional-thinking.md (437 lines) - Extract principles only for coding
  "11-functional-thinking.md":
    intents_to_load:
      - implement
      - debug
      - refactor
      - review
      - research
    sections:
      coding_tasks:
        - "Core Philosophy"
        - "The 16 Principles"
        - "Quick Reference"
      review_tasks:
        - "Core Philosophy"
        - "The 16 Principles"
        - "Quick Reference"
      research_tasks:
        - "Core Philosophy"
        - "When to Apply"
    skip:
      - "Application Hierarchy"
      - "Module Contract"
    intents_to_skip:
      - git
      - document

  # 00a-workflow-phases.md - Extract relevant phases only
  "00a-workflow-phases.md":
    sections:
      coding_tasks:
        - "MANDATORY PHASES"
        - "Phase 0: SPEC FOLDER SETUP"
        - "Phase 1: Intent Classification"
        - "Phase 2: Context Loading"
        - "Phase 3: Skill/Subagent Loading"
        - "Phase 4: Execute"
        - "Phase 5: UNIFY"
      review_tasks:
        - "Context Re-loading"
        - "Checkpoints"
      research_tasks:
        - "Context Re-loading"
    skip:
      - "Phase 6: SESSION SUMMARY"
      - "Phase 0.5"

  # 00b-context-economics.md - Extract core principles
  "00b-context-economics.md":
    sections:
      coding_tasks:
        - "Context Brackets"
        - "Plan Sizing"
        - "Lean Injection Principles"
      review_tasks:
        - "Context Brackets"
      research_tasks:
        - "Context Brackets"
        - "Plan Sizing"

  # 00c-validation-rules.md - Full for coding, skip for others
  "00c-validation-rules.md":
    sections:
      coding_tasks:
        - "All"
      review_tasks:
        - "All"
      research_tasks: []
    intents_to_skip:
      - git
      - document

  # 00d-reflection-phase.md - Core only
  "00d-reflection-phase.md":
    sections:
      coding_tasks:
        - "Core Reflection Guidelines"
      review_tasks:
        - "Core Reflection Guidelines"
      research_tasks:
        - "Core Reflection Guidelines"
    skip:
      - "Advanced Techniques"

---
# Complexity thresholds for lite mode

lite_mode_thresholds:
  skip_unify: 0.3 # Complexity below this skips UNIFY
  minimal_summary: 0.3 # Complexity below this uses lite SUMMARY template
  simple_spec: 0.2 # Complexity below this creates only todo.md

---
# Cache configuration

cache_config:
  classification_ttl: 600000 # 10 minutes
  extraction_ttl: 86400000 # 24 hours
  state_batch_flush: 5000 # 5 seconds
  quality_threshold: 0.8 # Minimum quality for cache
